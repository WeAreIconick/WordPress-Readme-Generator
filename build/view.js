!function(){"use strict";const e={maxFileSize:102400,allowedFileTypes:["text/plain"],allowedExtensions:["txt"],maxInputLength:{plugingName:100,shortDescription:150,description:5e3,installation:2e3,faqQuestion:200,faqAnswer:1e3,changelogChange:200,contributor:50,tag:30,version:20},maxItems:{faqs:20,changelogs:20,changes:10,contributors:10,tags:5},rateLimit:{maxRequests:100,timeWindow:36e5}};function t(e,t=1e3){if("string"!=typeof e)return"";let n=(e||"").trim().slice(0,t).replace(/[<>"'&\x00-\x1f\x7f-\x9f]/g,function(e){return{"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;"}[e]||""});return n=n.replace(/\s+/g," ").trim(),n}function n(e,t){switch(t){case"username":return/^[a-zA-Z0-9_-]{1,50}$/.test(e);case"version":return/^\d+\.\d+\.\d+$/.test(e);case"tag":return/^[a-zA-Z0-9_-]{1,30}$/.test(e);case"url":try{return new URL(e),!0}catch{return!1}case"email":return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);default:return!0}}function r(e,t={}){"undefined"!=typeof console&&console.warn&&console.warn("WordPress Readme Generator Security Event:",e,t),window.wp&&window.wp.apiFetch}function o(e,t=""){console.error("WordPress Readme Generator Error:",t,e),i(e.message||"An unexpected error occurred","error")}function i(e,n="info",r=5e3){const o=document.createElement("div");o.className=`readme-notification notice notice-${n}`,o.style.cssText="\n\t\t\tposition: fixed;\n\t\t\ttop: 32px;\n\t\t\tright: 20px;\n\t\t\tz-index: 999999;\n\t\t\tmax-width: 400px;\n\t\t\tpadding: 12px 16px;\n\t\t\tborder-radius: 4px;\n\t\t\tbox-shadow: 0 2px 8px rgba(0,0,0,0.3);\n\t\t\tbackground: white;\n\t\t\tborder-left: 4px solid #0073aa;\n\t\t\tanimation: slideIn 0.3s ease-out;\n\t\t","error"===n?(o.style.borderLeftColor="#d63638",o.style.background="#fcf0f1"):"success"===n&&(o.style.borderLeftColor="#00a32a",o.style.background="#f0f6fc"),o.textContent=t(e,200);const i=document.createElement("button");i.innerHTML="Ã—",i.style.cssText="\n\t\t\tfloat: right;\n\t\t\tbackground: none;\n\t\t\tborder: none;\n\t\t\tfont-size: 18px;\n\t\t\tcursor: pointer;\n\t\t\tmargin-left: 10px;\n\t\t",i.onclick=()=>o.remove(),o.appendChild(i),document.body.appendChild(o),r>0&&setTimeout(()=>{o.parentNode&&o.remove()},r)}function a(r,o,i){const a=r.indexOf(":");if(-1===a)return;const c=(r.substring(0,a)||"").trim().toLowerCase(),l=t((r.substring(a+1)||"").trim());if(l)switch(c){case"contributors":case"contributor":const r=l.split(",").map(e=>t((e||"").trim(),50)).filter(e=>e&&n(e,"username")).slice(0,e.maxItems.contributors);r.length>0&&(i.contributorsTags=r,s(o,"#contributors",r.join(", ")));break;case"tags":case"tag":const a=l.split(",").map(e=>t((e||"").trim(),30)).filter(e=>e&&n(e,"tag")).slice(0,e.maxItems.tags);a.length>0&&(i.tagsTags=a,s(o,"#tags",a.join(", ")));break;case"requires at least":case"requires wordpress":s(o,"#requiresAtLeast",l);break;case"tested up to":s(o,"#testedUpTo",l);break;case"stable tag":n(l,"version")&&s(o,"#version",l);break;case"requires php":s(o,"#requiresPHP",l)}}function s(e,n,r){try{const o=e.querySelector(n);if(!o||!r)return;const i=parseInt(o.maxLength)||1e3,a=t(r.toString(),i);"SELECT"===o.tagName?o.querySelector(`option[value="${a}"]`)&&(o.value=a):o.value=a,o.dispatchEvent(new Event("change",{bubbles:!0}))}catch(e){o(e,"field_value_setting")}}function c(i,a){try{if(!i.form)return"Error: Form not found";const o=new FormData(i.form),a={plugingName:t(o.get("pluginName")?.toString()||"Plugin Name",e.maxInputLength.pluginName),shortDescription:t(o.get("shortDescription")?.toString()||"Short description here.",e.maxInputLength.shortDescription),contributors:t(o.get("contributors")?.toString()||"username"),tags:t(o.get("tags")?.toString()||"plugin"),version:t(o.get("version")?.toString()||"1.0.0",20),requiresAtLeast:t(o.get("requiresAtLeast")?.toString()||"5.0"),testedUpTo:t(o.get("testedUpTo")?.toString()||"6.8"),requiresPHP:t(o.get("requiresPHP")?.toString()||"7.4"),description:t(o.get("description")?.toString()||"Detailed description here.",e.maxInputLength.description),installation:t(o.get("installation")?.toString()||"1. Upload to /wp-content/plugins/\n2. Activate the plugin",e.maxInputLength.installation)};n(a.version,"version")||(r("invalid_version_format",{version:a.version}),a.version="1.0.0");const s="= Question? =\n\nAnswer here.\n\n",c="= 1.0.0 =\n* Initial release\n\n";return`=== ${a.plugingName} ===\n\nContributors: ${a.contributors}\nTags: ${a.tags}\nRequires at least: ${a.requiresAtLeast}\nTested up to: ${a.testedUpTo}\nStable tag: ${a.version}\nRequires PHP: ${a.requiresPHP}\nLicense: GPLv2 or later\nLicense URI: https://www.gnu.org/licenses/gpl-2.0.html\n\n${a.shortDescription}\n\n== Description ==\n\n${a.description}\n\n== Installation ==\n\n${a.installation}\n\n== Frequently Asked Questions ==\n\n${s.trim()}\n\n== Changelog ==\n\n${c.trim()}`}catch(e){return o(e,"readme_generation"),"Error generating readme. Please check your inputs."}}document.addEventListener("DOMContentLoaded",function(){try{document.querySelectorAll(".wp-block-telex-block-wordpress-readme-generator-frontend").forEach(function(n){!function(n){try{if(!n.dataset.nonce&&(r("missing_nonce"),1))return void i("Security verification failed","error");if(!function(){const t=Date.now(),n="wordpress_readme_gen_requests";let r=JSON.parse(localStorage.getItem(n)||"[]");return r=r.filter(n=>t-n<e.rateLimit.timeWindow),!(r.length>=e.rateLimit.maxRequests||(r.push(t),localStorage.setItem(n,JSON.stringify(r)),0))}())return void i("Rate limit exceeded. Please try again later.","error");const l=function(e){const t={};try{t.form=e.querySelector("#readmeForm"),t.fileInput=e.querySelector("#readmeFile"),t.previewBtn=e.querySelector("#previewBtn"),t.downloadBtn=e.querySelector("#downloadBtn"),t.previewSection=e.querySelector("#previewSection"),t.previewContent=e.querySelector("#previewContent"),t.hidePreviewBtn=e.querySelector("#hidePreviewBtn"),t.addFAQBtn=e.querySelector("#addFAQ"),t.addChangelogBtn=e.querySelector("#addChangelog"),t.faqContainer=e.querySelector("#faqContainer"),t.changelogContainer=e.querySelector("#changelogContainer"),t.contributorsInput=e.querySelector("#contributorsInput"),t.addContributorBtn=e.querySelector("#addContributor"),t.contributorsDisplay=e.querySelector("#contributorsDisplay"),t.contributorsHidden=e.querySelector("#contributors"),t.tagsInput=e.querySelector("#tagsInput"),t.addTagBtn=e.querySelector("#addTag"),t.tagsDisplay=e.querySelector("#tagsDisplay"),t.tagsHidden=e.querySelector("#tags")}catch(e){o(e,"element_caching")}return t}(n);if(!l.form)throw new Error("Required form element not found");!function(n,c,l){c.fileInput&&c.fileInput.addEventListener("change",function(u){try{const d=u.target.files[0];if(!d)return;const g=function(t){if(!t||"object"!=typeof t)return{valid:!1,error:"No file provided"};if(t.size>e.maxFileSize)return{valid:!1,error:"File size too large (max 100KB)"};if(!e.allowedFileTypes.includes(t.type)&&"application/octet-stream"!==t.type)return{valid:!1,error:"Invalid file type"};const n=t.name.toLowerCase().split(".").pop();return e.allowedExtensions.includes(n)?/^[a-zA-Z0-9._-]+\.txt$/.test(t.name)?{valid:!0}:{valid:!1,error:"Invalid filename"}:{valid:!1,error:"Invalid file extension"}}(d);if(!g.valid)return r("invalid_file_upload",{error:g.error,filename:d.name}),i(g.error,"error"),void(u.target.value="");const p=new FileReader;p.onload=function(r){try{!function(n,r,i,c){if(!n||"string"!=typeof n)throw new Error("Invalid file content");if(n.length>5e4)throw new Error("File content too large");n=t(n,5e4);try{!function(n,r,i){const c=n.split("\n");let l=!1;const u=n.match(/===\s*(.+?)\s*===/i);if(u){const n=t(u[1],e.maxInputLength.pluginName);n&&s(r,"#pluginName",n)}for(let e=0;e<c.length;e++){const t=(c[e]||"").trim();if(!t.match(/^===.*===$/)||l){if(l&&""===t){let t=e+1;for(;t<c.length&&""===(c[t]||"").trim();)t++;if(t<c.length&&!(c[t]||"").trim().match(/^==\s+.*\s+==$/))break;continue}l&&t.includes(":")&&a(t,r,i)}else l=!0}!function(n,r){try{const o=n.match(/(?:License URI|Requires PHP|Stable tag):[^\n]*\n/i);if(o){const i=o.index+o[0].length,a=n.substring(i).match(/\n\s*([^\n=][^\n]*(?:\n(?![\n=])[^\n]*)*)(?:\n\n==|$)/i);if(a&&a[1]){let n=t((a[1]||"").trim().replace(/\n+/g," ").replace(/\s+/g," "),e.maxInputLength.shortDescription);n.length>5&&!n.includes(":")&&!n.toLowerCase().startsWith("contributors")&&s(r,"#shortDescription",n)}}}catch(e){o(e,"short_description_parsing")}}(n,r)}(n,r,c),function(n,r){const i={description:/==\s*Description\s*==([\s\S]*?)(?:==|$)/i,installation:/==\s*Installation\s*==([\s\S]*?)(?:==|$)/i};for(const[a,c]of Object.entries(i))try{const o=n.match(c);if(o&&o[1]){const n=t((o[1]||"").trim(),e.maxInputLength[a]||5e3);n&&s(r,"#"+a,n)}}catch(e){o(e,`${a}_section_parsing`)}}(n,r),parseFAQ(n,r,i,c),parseChangelog(n,r,i,c)}catch(e){throw new Error("Failed to parse readme sections: "+e.message)}}(r.target.result,n,c,l),i("File imported successfully!","success")}catch(e){o(e,"file_parsing"),i("Error parsing file. Please check the format.","error")}},p.onerror=function(){o(new Error("File read error"),"file_reading"),i("Error reading file","error")},p.readAsText(d)}catch(e){o(e,"file_upload")}})}(n,l,{contributorsTags:[],tagsTags:[],faqIndex:1,changelogIndex:1}),function(e){if(!e.form)return;e.form.querySelectorAll("[required]").forEach(e=>{e.addEventListener("blur",function(){!function(e){let t=!0,n="";e.required&&!(e.value||"").trim()&&(t=!1,n="This field is required"),t&&e.pattern&&e.value&&(new RegExp(e.pattern).test(e.value)||(t=!1,n="Invalid format")),t&&e.maxLength&&e.value.length>e.maxLength&&(t=!1,n=`Maximum length is ${e.maxLength} characters`),e.classList.toggle("has-error",!t);const r=e.parentNode.querySelector(".field-error");if(r&&r.remove(),!t&&n){const t=document.createElement("div");t.className="field-error",t.style.color="#d63638",t.style.fontSize="0.8em",t.style.marginTop="0.25em",t.textContent=n,e.parentNode.appendChild(t)}}(this)}),e.addEventListener("input",function(){this.classList.remove("has-error")})})}(l),function(e){e.hidePreviewBtn&&e.hidePreviewBtn.addEventListener("click",function(t){t.preventDefault(),e.previewSection&&(e.previewSection.style.display="none",e.previewSection.setAttribute("aria-hidden","true"))})}(l),function(e){e.previewBtn&&e.previewBtn.addEventListener("click",function(t){t.preventDefault();try{!function(e){if(!e.previewContent||!e.previewSection)return;const t=c(e);e.previewContent.textContent=t,e.previewSection.style.display="block",e.previewSection.setAttribute("aria-hidden","false"),e.previewSection.scrollIntoView({behavior:"smooth",block:"start"})}(e)}catch(e){o(e,"preview_generation")}}),e.downloadBtn&&e.downloadBtn.addEventListener("click",function(t){t.preventDefault();try{!function(e){try{const t=c(e);if(!t||t.length<10)throw new Error("Invalid readme content");const n=new Blob([t],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download="readme.txt",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(r),1e3),i("Readme file downloaded successfully!","success")}catch(e){o(e,"readme_download"),i("Error downloading readme. Please try again.","error")}}(e)}catch(e){o(e,"readme_download")}})}(l),i("Readme generator loaded successfully!","success",3e3)}catch(e){o(e,"generator_initialization")}}(n)})}catch(e){o(e,"initialization")}})}();