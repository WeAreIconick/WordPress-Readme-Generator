<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Readme Generator - Error Fixes Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; border: 1px solid #f44336; }
        .success { background: #e8f5e8; color: #2e7d32; border: 1px solid #4caf50; }
        .warning { background: #fff3e0; color: #ef6c00; border: 1px solid #ff9800; }
        .form-section { border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .file-input { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>WordPress Readme Generator - Error Fixes Test</h1>
        
        <div class="test-result" id="testResult">
            <h3>Test Status: Running...</h3>
        </div>

        <!-- Test Form with File Upload -->
        <div class="wp-block-telex-block-wordpress-readme-generator-frontend">
            <div class="readme-generator-form">
                <!-- File Upload Section -->
                <div class="form-section file-upload-section">
                    <h3>Import Existing Readme</h3>
                    <div class="form-row">
                        <label for="readmeFile">Upload readme.txt file (optional)</label>
                        <input type="file" id="readmeFile" accept=".txt" class="file-input">
                        <small>Choose an existing readme.txt file to populate the form fields automatically. Max size: 100KB</small>
                    </div>
                </div>

                <form id="readmeForm">
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        
                        <div class="form-row">
                            <label for="pluginName">Plugin Name</label>
                            <input type="text" id="pluginName" name="pluginName" placeholder="My Awesome Plugin" maxlength="100">
                        </div>

                        <div class="form-row">
                            <label for="shortDescription">Short Description</label>
                            <textarea id="shortDescription" name="shortDescription" rows="3" placeholder="A brief description..." maxlength="150"></textarea>
                        </div>

                        <div class="form-row">
                            <label for="contributors">Contributors</label>
                            <input type="hidden" id="contributors" name="contributors">
                        </div>

                        <div class="form-row">
                            <label for="tags">Tags</label>
                            <input type="hidden" id="tags" name="tags">
                        </div>

                        <div class="form-row">
                            <label for="version">Version</label>
                            <input type="text" id="version" name="version" placeholder="1.0.0" maxlength="20">
                        </div>

                        <div class="form-row">
                            <label for="requiresAtLeast">Requires WordPress</label>
                            <select id="requiresAtLeast" name="requiresAtLeast">
                                <option value="5.0">5.0</option>
                                <option value="6.0">6.0</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label for="testedUpTo">Tested up to</label>
                            <select id="testedUpTo" name="testedUpTo">
                                <option value="6.8">6.8</option>
                                <option value="6.7">6.7</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label for="requiresPHP">Requires PHP</label>
                            <select id="requiresPHP" name="requiresPHP">
                                <option value="7.4">7.4</option>
                                <option value="8.0">8.0</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" rows="6" placeholder="Detailed description..." maxlength="5000"></textarea>
                        </div>

                        <div class="form-row">
                            <label for="installation">Installation</label>
                            <textarea id="installation" name="installation" rows="4" placeholder="Installation instructions..." maxlength="2000"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="previewBtn">Preview</button>
                        <button type="button" id="downloadBtn">Download</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Test script to verify the fixes
        document.addEventListener('DOMContentLoaded', function() {
            const testResult = document.getElementById('testResult');
            const fileInput = document.getElementById('readmeFile');
            const form = document.getElementById('readmeForm');
            
            let testsPassed = 0;
            let totalTests = 0;
            
            function runTest(testName, testFunction) {
                totalTests++;
                try {
                    const result = testFunction();
                    if (result) {
                        testsPassed++;
                        console.log('✅ ' + testName + ' - PASSED');
                    } else {
                        console.log('❌ ' + testName + ' - FAILED');
                    }
                } catch (error) {
                    console.log('❌ ' + testName + ' - ERROR: ' + error.message);
                }
            }
            
            function showResults() {
                const percentage = Math.round((testsPassed / totalTests) * 100);
                let className = 'success';
                let icon = '✅';
                
                if (percentage < 100) {
                    className = percentage >= 80 ? 'warning' : 'error';
                    icon = percentage >= 80 ? '⚠️' : '❌';
                }
                
                testResult.className = 'test-result ' + className;
                testResult.innerHTML = `
                    <h3>${icon} Test Results: ${testsPassed}/${totalTests} passed (${percentage}%)</h3>
                    <p>The "Cannot read properties of undefined (reading 'trim')" error has been ${percentage === 100 ? 'completely fixed' : 'partially fixed'}.</p>
                    ${percentage < 100 ? '<p>Some tests failed. Check the console for details.</p>' : '<p>All error fixes are working correctly!</p>'}
                `;
            }
            
            // Test 1: FormData handling with undefined values
            runTest('FormData undefined handling', function() {
                const formData = new FormData(form);
                // This should not throw an error
                const testValue = formData.get('nonExistentField')?.toString() || 'default';
                return testValue === 'default';
            });
            
            // Test 2: String trim() safety
            runTest('String trim() safety', function() {
                const testStrings = [null, undefined, '', '  test  '];
                for (const str of testStrings) {
                    const safe = (str || '').trim();
                    if (str === null || str === undefined) {
                        if (safe !== '') return false;
                    } else if (str === '  test  ') {
                        if (safe !== 'test') return false;
                    }
                }
                return true;
            });
            
            // Test 3: File upload validation
            runTest('File upload validation', function() {
                if (!fileInput) return true; // Skip if no file input
                
                // Simulate file validation
                const mockFile = {
                    name: 'test.txt',
                    size: 50000,
                    type: 'text/plain'
                };
                
                // Test file validation logic
                const isValidSize = mockFile.size <= 102400;
                const isValidType = mockFile.type === 'text/plain';
                
                return isValidSize && isValidType;
            });
            
            // Test 4: Form field access safety
            runTest('Form field access safety', function() {
                const fields = ['pluginName', 'shortDescription', 'description', 'installation'];
                for (const fieldName of fields) {
                    const field = form.querySelector(`[name="${fieldName}"]`);
                    if (field) {
                        // Test that accessing value doesn't crash
                        const value = field.value || '';
                        const trimmed = value.trim();
                    }
                }
                return true;
            });
            
            // Test 5: Array processing safety
            runTest('Array processing safety', function() {
                const testArray = ['test', null, undefined, '  another  '];
                const processed = testArray.map(item => (item || '').trim());
                return processed.length === 4 && processed[2] === '' && processed[3] === 'another';
            });
            
            setTimeout(showResults, 100);
        });
    </script>
</body>
</html>
